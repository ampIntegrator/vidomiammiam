# Claude Code Safeguards

## CRITICAL: Database Protection

### ‚õî NEVER USE THESE COMMANDS
```bash
PAYLOAD_DROP_DATABASE=true     # DESTROYS ALL DATA
rm dev.db                       # DESTROYS ALL DATA
```

### ‚úÖ Correct Approach for Schema Changes

When Payload asks interactive questions about schema changes:

**Option 1: Manual Response**
- Let the dev server run
- Answer the prompts manually in the terminal
- Type the answers when asked

**Option 2: Create Migration**
```bash
npx pnpm payload migrate:create <migration-name>
npx pnpm payload migrate
```

**Option 3: Restart and Accept**
- Restart the dev server
- Accept the proposed changes

### üîí Before ANY Database Operation

1. Check if command can delete data
2. Create backup: `cp dev.db dev.db.backup-$(date +%Y%m%d-%H%M%S)`
3. Verify with user if uncertain

### üìù Incident Log

- **2025-12-10**: Used PAYLOAD_DROP_DATABASE=true during schema migration
  - **Impact**: Complete database wipe (users, globals, all content)
  - **Root cause**: Attempting to bypass interactive schema prompts
  - **Lesson**: NEVER use this flag. Handle migrations properly.
  - **Prevention**: This safeguards file + systematic backup before schema changes

## Why This Matters

- Database restoration takes time and effort
- User trust is damaged with each data loss
- Some data may be unrecoverable
- Professional systems NEVER drop production-like databases casually

## Commitment

I commit to:
1. Never using destructive database commands without explicit user approval
2. Always backing up before schema changes
3. Following proper migration procedures
4. Asking for clarification when uncertain about data safety
